<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
    <div th:fragment="theory-section" class="theory-section">
        <div class="theory-header" onclick="toggleTheorySection()">
            <h2>
                <span class="toggle-icon" id="theory-toggle-icon">â–¶</span>
                Understanding Spring TestContext Context Caching
            </h2>
            <p class="theory-subtitle">Click to learn about Spring TestContext context caching principles and optimization tips</p>
        </div>
        <div class="theory-content" id="theory-content" style="display: none;">
            <p>Spring Test Framework provides <strong>context caching</strong> to improve test performance by reusing ApplicationContext instances across multiple test classes when they share the same configuration.</p>

            <h3>How Context Caching Works</h3>
            <p>Spring generates a <strong>cache key</strong> based on:</p>
            <ul>
                <li><strong>Context Loader</strong> - The class responsible for loading the context</li>
                <li><strong>Locations & Classes</strong> - Configuration files/classes specified in @ContextConfiguration</li>
                <li><strong>Active Profiles</strong> - Profiles activated via @ActiveProfiles</li>
                <li><strong>Property Sources</strong> - Test property sources from @TestPropertySource</li>
                <li><strong>Context Initializers</strong> - Custom context initializers</li>
                <li><strong>Context Customizers</strong> - Customizers from test slices like @WebMvcTest</li>
            </ul>

            <div class="cache-behavior">
                <div class="cache-hit">
                    <h4>ðŸŽ¯ Cache Hit</h4>
                    <p>When a test class has the <em>same exact configuration</em> as a previous test, Spring reuses the existing ApplicationContext. This results in faster test execution.</p>
                </div>
                <div class="cache-miss">
                    <h4>ðŸ”„ Cache Miss</h4>
                    <p>When a test class has a <em>different configuration</em>, Spring creates a new ApplicationContext. This takes more time but ensures test isolation.</p>
                </div>
            </div>

            <h3>Optimization Tips</h3>
            <ul>
                <li><strong>Group similar tests:</strong> Use the same @ContextConfiguration across related test classes</li>
                <li><strong>Minimize @DirtiesContext:</strong> Avoid marking contexts as dirty unless absolutely necessary</li>
                <li><strong>Use test slices:</strong> @WebMvcTest, @DataJpaTest create focused, cacheable contexts</li>
                <li><strong>Consolidate profiles:</strong> Use consistent @ActiveProfiles across test classes</li>
            </ul>

            <div class="docs-links">
                <h3>ðŸ“š Learn More</h3>
                <p>For detailed information about Spring Test context caching:</p>
                <ul>
                    <li><a href="https://docs.spring.io/spring-framework/reference/testing/testcontext-framework/ctx-management/caching.html" target="_blank">Context Caching - Spring Framework Reference</a></li>
                    <li><a href="https://docs.spring.io/spring-boot/reference/testing/spring-boot-applications.html" target="_blank">Testing Spring Boot Applications</a></li>
                    <li><a href="https://docs.spring.io/spring-framework/reference/testing/annotations/integration-spring/annotation-dirtiescontext.html" target="_blank">@DirtiesContext Annotation</a></li>
                    <li><a th:href="@{'https://rieckpil.de/improve-build-times-with-context-caching-from-spring-test/' + ${utmParameters}}" target="_blank">Improve Build Times with Spring TestContext Context Caching</a></li>
                    <li><a href="https://www.youtube.com/watch?v=c-GV2PxymoY" target="_blank">How fixing a broken window cut down our build time by 50% (Spring I/O talk)</a></li>
                    <li><a th:href="@{'https://rieckpil.de/testing-spring-boot-applications-masterclass/' + ${utmParameters}}" target="_blank">Testing Spring Boot Applications Masterclass</a></li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>
